# Zipkin

## 0. 官网

- [zipkin官网](https://zipkin.io/)

`Zipkin` 是一个开源的分布式追踪系统，主要用于收集、存储和查询微服务系统中请求的执行跟踪信息。它帮助开发人员和运维人员了解服务间调用的情况，定位性能瓶颈和故障问题。以下是关于 Zipkin 的主要知识点总结：

> 注：最新内容直接看官方文档
> 
> 下面这个是AI生成的，先不改了

## 1. 功能与作用

- `分布式追踪`：Zipkin 主要用于在微服务架构中追踪请求的执行路径，帮助开发人员了解一个请求从发起到结束的整个流转过程。
- `性能优化`：通过分析分布式跟踪数据，可以发现服务间的延迟瓶颈，优化系统性能。
- `故障排查`：在发生故障时，Zipkin 能帮助你快速找到问题的根源，了解哪个服务或环节出现了异常。

## 2. 核心概念

- `Trace`：一个完整的请求执行路径，表示从请求开始到结束的整个过程。一个 trace 可以跨越多个服务和操作。
- `Span`：表示 Trace 中的一个操作（即服务调用）。每个 Span 包含操作的开始时间、结束时间以及与其它 Span 的关系（如父子关系）。
- `Annotation`：在每个 Span 中记录的关键事件时间点，用来标识具体的操作，例如请求开始、结束、错误等。
- `Link`：表示多个 Traces 之间的关系，用于标识不同请求之间的关联。

## 3. Zipkin 架构

Zipkin 的架构通常包含以下几个组件：

- `客户端/应用`：在每个微服务中集成 Zipkin 客户端，收集请求的跟踪信息（如 Trace 和 Span）。
- `Collector`：负责接收客户端发送的跟踪数据，并将其存储到数据库或其他存储介质。
- `Storage`：Zipkin 支持多种存储后端，包括内存、MySQL、Elasticsearch 等。
- `查询接口`：提供查询 API 或 Web 界面，允许用户查看和分析跟踪数据。

## 4. 集成与使用

- `Spring Cloud Sleuth 集成`：Spring Cloud Sleuth 是与 Spring Boot 项目紧密集成的一个工具，它与 Zipkin 配合使用，自动为请求添加 Trace 和 Span 数据。
- `Zipkin 客户端集成`：通过在微服务中引入 Zipkin 客户端库，自动为每个 HTTP 请求、RPC 调用等创建 Trace 和 Span 数据。

示例：

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-zipkin</artifactId>
</dependency>
```

## 5. 数据收集与展示

- `数据收集`：在每个微服务中集成 Zipkin，自动收集请求的跟踪信息。
- `数据展示`：通过 Zipkin 提供的 Web UI 或自定义界面展示跟踪数据，包括 Trace 的延迟图、调用链等。可以通过 UI 查看每个请求的详细信息，如请求的响应时间、调用的服务等。

## 6. 优势

- `透明度高`：可以清楚地了解微服务间的调用关系和性能表现。
- `易于集成`：支持多种语言和框架，易于与现有应用集成。
- `故障定位快`：通过 Trace 和 Span 信息，能迅速找到请求中的延迟或错误来源。

## 7. 应用场景

- `微服务架构`：在微服务架构中，服务之间的调用复杂且分布式，Zipkin 可以有效追踪和监控请求流，保证服务的健康运行。
- `性能调优`：帮助开发人员识别和优化系统的性能瓶颈。
- `分布式调试`：定位分布式系统中的错误和故障，减少排查问题的时间。

## 8. 常见的替代品

- `Jaeger`：由 Uber 开发的开源分布式追踪系统，与 Zipkin 类似，但具有更丰富的功能和可扩展性。
- `OpenTelemetry`：一个更通用的监控框架，支持跟踪、度量和日志的标准化，支持 Zipkin 和 Jaeger 的导出。

## 9. 与其他工具的集成

- `与 Prometheus/Grafana 集成`：Zipkin 的追踪数据可以与 Prometheus 等监控工具结合，提供更全面的系统监控。
- `与 Kafka 集成`：Zipkin 支持将追踪数据通过 Kafka 进行传输，用于高吞吐量的分布式系统中。

## 10. 部署与运行

- `Zipkin 服务`：Zipkin 可以作为独立的服务运行，通常使用 Docker 部署，提供 Web 界面和 API 进行查询。

  ```bash
  docker run -d -p 9411:9411 openzipkin/zipkin
  ```

- **Zipkin 存储**：可以配置 Zipkin 使用多种后端存储，如 MySQL、Cassandra、Elasticsearch 等。

总结来说，**Zipkin** 是一个强大的分布式追踪系统，能够帮助开发者了解微服务之间的请求流，快速发现问题，优化系统性能。在微服务架构中，它是非常重要的监控和诊断工具。
